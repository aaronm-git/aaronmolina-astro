---
/**
 * Headless CMS Developer Page
 * Target: "headless cms developer" (vol 150, KD 62)
 * Secondary: "sanity developer", "contentful developer"
 */
import { HireTemplate } from '@/templates';
import { getCollection } from 'astro:content';
import { createTechMap } from '@/utils/tech-lookup';
import hireContent from '@/content/site/hire.json';

// Fetch data
const technologies = await getCollection('technologies');
const techMap = createTechMap(technologies);
const projects = await getCollection('projects');

// Get CMS-related projects
const cmsProjects = projects
  .filter(p => p.data.isActive !== false)
  .filter(p => p.data.technologies?.some(t => ['sanity', 'contentful', 'strapi', 'headless-cms'].includes(t)))
  .sort((a, b) => {
    if (a.data.featured && !b.data.featured) return -1;
    if (!a.data.featured && b.data.featured) return 1;
    return (a.data.sortOrder ?? 0) - (b.data.sortOrder ?? 0);
  })
  .slice(0, 3);

// Calculate years of experience
const yearsOfExperience = new Date().getFullYear() - hireContent.yearsOfExperienceStartYear;

// Process stats with dynamic values
const stats = hireContent.shared.stats.map(stat => ({
  ...stat,
  value: String(stat.value).replace('{yearsOfExperience}', String(yearsOfExperience)),
}));
---

<HireTemplate
  title={hireContent.headlessCms.meta.title}
  description={hireContent.headlessCms.meta.description}
  currentPath="/hire/headless-cms"
  hero={{
    headline: hireContent.headlessCms.hero.headline,
    subheadline: hireContent.headlessCms.hero.subheadline,
    description: hireContent.headlessCms.hero.description,
    badges: hireContent.headlessCms.hero.badges,
    primaryCta: hireContent.headlessCms.hero.primaryCta,
    secondaryCta: hireContent.headlessCms.hero.secondaryCta,
  }}
  stats={stats}
  services={{
    title: hireContent.headlessCms.services.title,
    subtitle: hireContent.headlessCms.services.subtitle,
    items: hireContent.headlessCms.services.items,
  }}
  features={{
    title: hireContent.headlessCms.features.title,
    items: hireContent.headlessCms.features.items,
  }}
  skills={{
    title: hireContent.headlessCms.skills.title,
    subtitle: hireContent.headlessCms.skills.subtitle,
    categories: hireContent.headlessCms.skills.categories,
    techMap: techMap,
  }}
  projects={{
    title: "Headless CMS Projects",
    items: cmsProjects,
    viewAllHref: "/projects",
    viewAllLabel: "View all projects",
  }}
  faq={{
    title: "Frequently Asked Questions",
    subtitle: "Common questions about headless CMS development",
    items: hireContent.shared.faq,
  }}
  cta={hireContent.shared.cta}
/>
