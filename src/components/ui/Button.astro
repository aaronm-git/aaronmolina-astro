---
import type { IconType } from 'react-icons';
import { getIcon } from '@/utils/icons';

type ButtonVariant = 'primary' | 'secondary' | 'outline' | 'ghost' | 'link' | 'tactile';
type ButtonSize = 'sm' | 'base' | 'lg';

interface Props {
  /** URL for link buttons (renders as <a>) */
  href?: string;
  /** Visual variant */
  variant?: ButtonVariant;
  /** Button size */
  size?: ButtonSize;
  /** Icon name (uses getIcon to resolve) */
  icon?: string;
  /** Direct icon component */
  iconComponent?: IconType;
  /** Icon position */
  iconPosition?: 'left' | 'right';
  /** Open link in new tab */
  external?: boolean;
  /** Full width button */
  fullWidth?: boolean;
  /** Disabled state */
  disabled?: boolean;
  /** Button type (for form buttons) */
  type?: 'button' | 'submit' | 'reset';
  /** Additional CSS classes */
  class?: string;
  /** Aria label */
  ariaLabel?: string;
}

const {
  href,
  variant = 'primary',
  size = 'base',
  icon,
  iconComponent,
  iconPosition = 'left',
  external = false,
  fullWidth = false,
  disabled = false,
  type = 'button',
  class: className = '',
  ariaLabel,
} = Astro.props;

// Resolve icon
const IconComponent = iconComponent || (icon ? getIcon(icon) : null);

// Variant classes
const variantClasses: Record<ButtonVariant, string> = {
  primary: 'bg-primary hover:bg-primary-hover text-on-primary focus:ring-primary',
  secondary: 'bg-secondary hover:bg-secondary-hover text-on-secondary focus:ring-secondary',
  outline: 'bg-transparent border border-border text-foreground hover:bg-muted focus:ring-border',
  ghost: 'bg-transparent text-foreground hover:bg-muted focus:ring-muted',
  link: 'bg-transparent text-secondary hover:text-secondary-hover underline-offset-4 hover:underline p-0',
  tactile: 'tactile-btn',
};

// Size classes
const sizeClasses: Record<ButtonSize, string> = {
  sm: 'px-3 py-1.5 text-sm gap-1.5',
  base: 'px-4 py-2 text-base gap-2',
  lg: 'px-6 py-3 text-lg gap-2.5',
};

// Icon size based on button size
const iconSizeClasses: Record<ButtonSize, string> = {
  sm: 'icon-xs',
  base: 'icon-sm',
  lg: 'icon-base',
};

// Build combined classes
const baseClasses = 'inline-flex items-center justify-center font-medium transition-all rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-background';
const disabledClasses = disabled ? 'opacity-50 cursor-not-allowed pointer-events-none' : '';
const widthClasses = fullWidth ? 'w-full' : '';

const combinedClasses = [
  baseClasses,
  variantClasses[variant],
  variant !== 'link' ? sizeClasses[size] : 'gap-1',
  disabledClasses,
  widthClasses,
  className,
].filter(Boolean).join(' ');

const iconClass = iconSizeClasses[size];
const isLink = !!href;
const Element = isLink ? 'a' : 'button';

// Link-specific props
const linkProps = isLink ? {
  href,
  target: external ? '_blank' : undefined,
  rel: external ? 'noopener noreferrer' : undefined,
} : {};

// Button-specific props
const buttonProps = !isLink ? {
  type,
  disabled,
} : {};
---

{isLink ? (
  <a
    {...linkProps}
    class={combinedClasses}
    aria-label={ariaLabel}
  >
    {iconPosition === 'left' && IconComponent && (
      <IconComponent className={`${iconClass} ${variant === 'link' ? 'transition-transform group-hover:-translate-x-1' : ''}`} />
    )}
    <slot />
    {iconPosition === 'right' && IconComponent && (
      <IconComponent className={`${iconClass} ${variant === 'link' ? 'transition-transform group-hover:translate-x-1' : ''}`} />
    )}
  </a>
) : (
  <button
    {...buttonProps}
    class={combinedClasses}
    aria-label={ariaLabel}
  >
    {iconPosition === 'left' && IconComponent && (
      <IconComponent className={iconClass} />
    )}
    <slot />
    {iconPosition === 'right' && IconComponent && (
      <IconComponent className={iconClass} />
    )}
  </button>
)}
