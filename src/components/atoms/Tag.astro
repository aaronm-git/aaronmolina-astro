---
import type { TechMap } from '@/lib/tech-lookup';
import { getTechName } from '@/lib/tech-lookup';
import { cn } from '@/lib/cn';

type TagVariant = 'default' | 'muted' | 'outline' | 'featured' | 'tactile' | 'glass';
type TagSize = 'xs' | 'sm' | 'base';

interface Props {
  /** Display label (use this OR slug + techMap) */
  label?: string;
  /** Technology slug (requires techMap to resolve to name) */
  slug?: string;
  /** Technology lookup map for resolving slugs */
  techMap?: TechMap;
  /** Visual variant */
  variant?: TagVariant;
  /** Tag size */
  size?: TagSize;
  /** Optional link */
  href?: string;
  /** Removable tag */
  removable?: boolean;
  /** Additional CSS classes */
  class?: string;
}

const {
  label,
  slug,
  techMap,
  variant = 'default',
  size = 'sm',
  href,
  removable = false,
  class: className = '',
} = Astro.props;

// Resolve display text
const displayText = label || (slug && techMap ? getTechName(slug, techMap) : slug) || '';

// Build variant classes
const variantClasses: Record<TagVariant, string> = {
  default: 'bg-muted text-foreground border-border border',
  muted: 'bg-muted/50 text-foreground-muted border-border/50 border',
  outline: 'bg-transparent text-foreground border-border border',
  featured: 'bg-secondary text-on-secondary',
  tactile: 'tag-tactile bg-primary/10 text-primary border-primary/20 border',
  glass: 'tag-glass backdrop-blur-sm bg-white/10 text-foreground border-white/20 border',
};

// Build size classes
const sizeClasses: Record<TagSize, string> = {
  xs: 'px-1.5 py-0.5 text-[10px]',
  sm: 'px-2 py-1 text-xs',
  base: 'px-3 py-1.5 text-sm',
};

const baseClasses = 'inline-flex items-center rounded font-medium transition-colors';
const combinedClasses = cn(
  baseClasses,
  variantClasses[variant],
  sizeClasses[size],
  href && 'hover:opacity-80 cursor-pointer',
  className,
);
---

{href ? (
  <a href={href} class={combinedClasses}>
    {displayText}
    {removable && (
      <button type="button" class="ml-1 hover:text-error" aria-label="Remove">
        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    )}
  </a>
) : (
  <span class={combinedClasses}>
    {displayText}
    {removable && (
      <button type="button" class="ml-1 hover:text-error" aria-label="Remove">
        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    )}
  </span>
)}

<style>
  .tag-tactile {
    box-shadow: 0 2px 0 color-mix(in srgb, var(--primary) 30%, transparent);
  }

  .tag-glass {
    backdrop-filter: blur(8px);
  }
</style>
