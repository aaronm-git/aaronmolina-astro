---
import Text from '@/components/atoms/Text.astro';
import Icon from '@/components/atoms/Icon.astro';
import { cn } from '@/lib/cn';
import type { IconType } from 'react-icons';

type StatAlign = 'left' | 'center' | 'right';
type StatSize = 'sm' | 'base' | 'lg' | 'xl';

interface Props {
  /** Stat value (number or string) */
  value: string | number;
  /** Stat label */
  label: string;
  /** Optional prefix (e.g., "$", "+") */
  prefix?: string;
  /** Optional suffix (e.g., "%", "K") */
  suffix?: string;
  /** Icon name */
  icon?: string;
  /** Direct icon component */
  iconComponent?: IconType;
  /** Alignment */
  align?: StatAlign;
  /** Size */
  size?: StatSize;
  /** Highlight value with primary color */
  highlight?: boolean;
  /** Additional CSS classes */
  class?: string;
}

const {
  value,
  label,
  prefix,
  suffix,
  icon,
  iconComponent,
  align = 'left',
  size = 'base',
  highlight = false,
  class: className = '',
} = Astro.props;

// Alignment classes
const alignClasses: Record<StatAlign, string> = {
  left: 'text-left items-start',
  center: 'text-center items-center',
  right: 'text-right items-end',
};

// Size mapping for value
const valueSizeClasses: Record<StatSize, string> = {
  sm: 'text-2xl',
  base: 'text-3xl md:text-4xl',
  lg: 'text-4xl md:text-5xl',
  xl: 'text-5xl md:text-6xl',
};

// Icon size mapping
const iconSizeMap: Record<StatSize, 'sm' | 'base' | 'lg' | 'xl'> = {
  sm: 'sm',
  base: 'base',
  lg: 'lg',
  xl: 'xl',
};

const combinedClasses = cn(
  'flex flex-col',
  alignClasses[align],
  className,
);

const valueClasses = cn(
  'font-bold tabular-nums',
  valueSizeClasses[size],
  highlight ? 'text-primary' : 'text-foreground',
);
---

<div class={combinedClasses}>
  {(icon || iconComponent) && (
    <Icon
      name={icon}
      icon={iconComponent}
      size={iconSizeMap[size]}
      color={highlight ? 'primary' : 'secondary'}
      class="mb-2"
    />
  )}
  <div class={valueClasses}>
    {prefix && <span class="text-foreground-muted">{prefix}</span>}
    {value}
    {suffix && <span class="text-foreground-muted text-[0.6em]">{suffix}</span>}
  </div>
  <Text size={size === 'sm' ? 'sm' : 'base'} color="muted" class="mt-1">
    {label}
  </Text>
</div>
