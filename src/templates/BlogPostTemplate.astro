---
/**
 * BlogPostTemplate - Template for individual blog posts
 *
 * Provides consistent blog post structure with:
 * - Back to blog navigation
 * - Title and description hero
 * - Publish/update dates
 * - Content area with typography styles
 * - Tags section
 * - CTA for engagement
 *
 * @example
 * <BlogPostTemplate post={post} techMap={techMap}>
 *   <Content />
 * </BlogPostTemplate>
 */
import type { CollectionEntry } from 'astro:content';
import MainLayout from '@/layouts/main-layout.astro';
import HeroSection from '@/components/organisms/sections/HeroSection.astro';
import CTASection from '@/components/organisms/sections/CTASection.astro';
import Button from '@/components/atoms/Button.astro';
import Text from '@/components/atoms/Text.astro';
import TagList from '@/components/molecules/TagList.astro';
import { formatDate, toISODateString } from '@/utils/date-format';
import type { TechMap } from '@/utils/tech-lookup';

interface Props {
  /** Blog post entry from collection */
  post: CollectionEntry<'blog'>;
  /** Technology map for resolving tag names */
  techMap?: TechMap;
  /** CTA title override */
  ctaTitle?: string;
  /** CTA description override */
  ctaDescription?: string;
}

const {
  post,
  techMap,
  ctaTitle = 'Want to work together?',
  ctaDescription = "I'm available for Jamstack development, headless CMS integration, and frontend architecture consulting.",
} = Astro.props;

const { title, description, publishDate, updatedDate, tags } = post.data;

// Format dates
const publishDateFormatted = publishDate ? formatDate(publishDate, 'long') : '';
const publishDateISO = publishDate ? toISODateString(publishDate) : '';
const updatedDateFormatted = updatedDate ? formatDate(updatedDate, 'long') : '';
const showUpdated = updatedDate && publishDate && updatedDate.getTime() !== publishDate.getTime();
---

<MainLayout title={title} description={description}>
  <article class="mx-auto max-w-screen-md">
    {/* Back Navigation */}
    <nav class="mb-4 px-4">
      <Button href="/blog" variant="ghost" icon="arrowLeft" size="sm">
        Back to Blog
      </Button>
    </nav>

    {/* Post Header */}
    <HeroSection
      variant="minimal"
      headline={title}
      description={description}
      class="py-4"
    >
      {/* Date metadata */}
      <div class="mt-4 flex flex-wrap items-center justify-center gap-4 text-sm text-foreground-muted">
        {publishDate && (
          <time datetime={publishDateISO}>{publishDateFormatted}</time>
        )}
        {showUpdated && (
          <>
            <span>â€¢</span>
            <span>Updated {updatedDateFormatted}</span>
          </>
        )}
      </div>
    </HeroSection>

    {/* Post Content */}
    <div class="typography px-4 py-8">
      <slot />
    </div>

    {/* Tags Section */}
    {tags && tags.length > 0 && techMap && (
      <section class="border-border border-t px-4 py-8">
        <Text as="p" size="sm" color="muted" weight="semibold" class="mb-4 uppercase tracking-wide">
          Topics
        </Text>
        <TagList tags={tags} techMap={techMap} />
      </section>
    )}

    {/* CTA Section */}
    <CTASection
      title={ctaTitle}
      description={ctaDescription}
      buttonLabel="Get in Touch"
      buttonHref="/contact"
      class="mt-8"
    />
  </article>
</MainLayout>
