---
import MainLayout from '@/layouts/main-layout.astro';
import { FaBriefcase, FaBolt, FaUsers, FaShieldCat, FaClock, FaCalendar, FaGlobe, FaUser, FaGithub, FaLinkedin, FaInstagram } from 'react-icons/fa6';
import pages from '@/content/site/pages.json';
import settings from '@/content/site/settings.json';

// Netlify Turnstile site key - configure this in your Netlify dashboard
// Go to Site settings > Security & privacy > Turnstile
const TURNSTILE_SITE_KEY = import.meta.env.PUBLIC_TURNSTILE_SITE_KEY || 'YOUR_TURNSTILE_SITE_KEY';

const whyIcons = [FaBriefcase, FaBolt, FaUsers, FaShieldCat];
const responseIcons = [FaClock, FaCalendar, FaGlobe];

const socialIconForPlatform = (platform?: string) => {
  switch ((platform || '').toLowerCase()) {
    case 'github':
      return FaGithub;
    case 'linkedin':
      return FaLinkedin;
    case 'instagram':
      return FaInstagram;
    default:
      return null;
  }
};
---

<MainLayout title={pages.contact.metaTitle} description={pages.contact.metaDescription}>
  <!-- Header -->
  <section class="animate-section mb-12 text-center">
    <h1 class="text-foreground mb-4 text-5xl font-bold">{pages.contact.heading}</h1>
    <p class="text-foreground-muted mx-auto max-w-2xl text-lg">
      {pages.contact.intro}
    </p>
  </section>

  <!-- Contact Form -->
  <div class="animate-section mb-16 grid gap-12 lg:grid-cols-2">
    <!-- Form -->
    <div class="animate-content bg-surface border-border rounded-lg border p-8 shadow-md">
      <h2 class="text-foreground mb-6 text-2xl font-bold">{pages.contact.formTitle}</h2>

      <form id="contact-form" name="contact" method="POST" data-netlify="true" netlify-honeypot="bot-field" class="space-y-6">
        <div class="grid gap-6 md:grid-cols-2">
          <div>
            <label for="name" class="text-foreground mb-2 block text-sm font-medium">Full Name</label>
            <input
              type="text"
              name="name"
              required
              class="border-border bg-surface text-foreground placeholder:text-foreground-muted focus:border-ring focus:ring-ring focus:ring-offset-background w-full rounded-md border px-3 py-2 focus:ring-2 focus:ring-offset-2 focus:outline-none"
              placeholder="Your name"
            />
          </div>

          <div>
            <label for="email" class="text-foreground mb-2 block text-sm font-medium">Email Address</label>
            <input
              type="email"
              name="email"
              required
              class="border-border bg-surface text-foreground placeholder:text-foreground-muted focus:border-ring focus:ring-ring focus:ring-offset-background w-full rounded-md border px-3 py-2 focus:ring-2 focus:ring-offset-2 focus:outline-none"
              placeholder="your@email.com"
            />
          </div>
        </div>

        <div>
          <label for="company" class="text-foreground mb-2 block text-sm font-medium">Company (Optional)</label>
          <input
            type="text"
            name="company"
            class="border-border bg-surface text-foreground placeholder:text-foreground-muted focus:border-ring focus:ring-ring focus:ring-offset-background w-full rounded-md border px-3 py-2 focus:ring-2 focus:ring-offset-2 focus:outline-none"
            placeholder="Your company"
          />
        </div>

        <div>
          <label for="project-type" class="text-foreground mb-2 block text-sm font-medium">Project Type</label>
          <select
            name="project-type"
            class="border-border bg-surface text-foreground focus:border-ring focus:ring-ring focus:ring-offset-background w-full rounded-md border px-3 py-2 focus:ring-2 focus:ring-offset-2 focus:outline-none"
          >
            <option value="">Select a project type</option>
            <option value="frontend">Frontend Development</option>
            <option value="fullstack">Full-Stack Application</option>
            <option value="website">Website Development</option>
            <option value="consultation">Technical Consultation</option>
            <option value="optimization">Performance Optimization</option>
            <option value="other">Other</option>
          </select>
        </div>

        <div>
          <label for="budget" class="text-foreground mb-2 block text-sm font-medium">Budget Range (Optional)</label>
          <select
            name="budget"
            class="border-border bg-surface text-foreground focus:border-ring focus:ring-ring focus:ring-offset-background w-full rounded-md border px-3 py-2 focus:ring-2 focus:ring-offset-2 focus:outline-none"
          >
            <option value="">Select budget range</option>
            <option value="under-5k">Under $5,000</option>
            <option value="5k-15k">$5,000 - $15,000</option>
            <option value="15k-30k">$15,000 - $30,000</option>
            <option value="30k-plus">$30,000+</option>
            <option value="discuss">Let's discuss</option>
          </select>
        </div>

        <div>
          <label for="message" class="text-foreground mb-2 block text-sm font-medium">Project Details</label>
          <textarea
            name="message"
            rows="6"
            required
            class="border-border bg-surface text-foreground placeholder:text-foreground-muted focus:border-ring focus:ring-ring focus:ring-offset-background w-full rounded-md border px-3 py-2 focus:ring-2 focus:ring-offset-2 focus:outline-none"
            placeholder="Tell me about your project, timeline, and any specific requirements..."></textarea>
        </div>

        <!-- Hidden fields for Netlify -->
        <input type="hidden" name="form-name" value="contact" />
        <!-- Honeypot field for spam protection -->
        <input type="hidden" name="bot-field" />

        <!-- Netlify Turnstile Captcha -->
        <div class="cf-turnstile" data-sitekey={TURNSTILE_SITE_KEY}></div>

        <button
          type="submit"
          class="bg-secondary hover:bg-secondary-hover text-on-secondary focus:ring-ring focus:ring-offset-background flex w-full items-center justify-center gap-2 rounded-md px-4 py-3 font-medium transition-colors focus:ring-2 focus:ring-offset-2 focus:outline-none disabled:cursor-not-allowed disabled:opacity-50"
        >
          <span>Send Message</span>
        </button>
      </form>
    </div>

    <!-- Contact Info -->
    <div class="space-y-8">
      <div class="animate-content bg-surface border-border rounded-lg border p-6 shadow-md">
        <h3 class="text-foreground mb-4 text-xl font-bold">{pages.contact.whyWorkWithMeTitle}</h3>
        <div class="space-y-4">
          {pages.contact.whyWorkWithMeItems.map((item, idx) => {
            const Icon = whyIcons[idx] ?? FaBriefcase;
            return (
              <div class="flex items-start gap-3">
                <Icon className="text-secondary icon-base mt-1 flex-shrink-0" />
                <div>
                  <h4 class="text-foreground font-medium">{item.title}</h4>
                  <p class="text-foreground-muted text-sm">{item.description}</p>
                </div>
              </div>
            );
          })}
        </div>
      </div>

      <div class="animate-content bg-surface border-border rounded-lg border p-6 shadow-md">
        <h3 class="text-foreground mb-4 text-xl font-bold">{pages.contact.responseTimeTitle}</h3>
        <div class="space-y-3">
          {pages.contact.responseTimeItems.map((text, idx) => {
            const Icon = responseIcons[idx] ?? FaClock;
            return (
              <div class="flex items-center gap-2">
                <Icon className="text-secondary size-icon-sm mt-0.5" />
                <span class="text-foreground-muted text-sm">{text}</span>
              </div>
            );
          })}
        </div>
      </div>

      <div class="animate-content bg-muted border-border rounded-lg border p-6">
        <h3 class="text-foreground mb-3 text-lg font-bold">{pages.contact.readyToStartTitle}</h3>
        <p class="text-foreground-muted mb-4 text-sm">{pages.contact.readyToStartDescription}</p>
        <div class="flex gap-3">
          <a
            href="/projects"
            class="text-secondary hover:text-secondary-hover border-secondary hover:border-secondary-hover flex items-center gap-1 rounded-lg border px-4 py-2 text-sm font-medium transition-colors"
          >
            <FaBriefcase className="icon-sm" />
            {pages.contact.readyLinks.viewProjectsLabel}
          </a>
          <a
            href="/experience"
            class="text-secondary hover:text-secondary-hover border-secondary hover:border-secondary-hover flex items-center gap-1 rounded-lg border px-4 py-2 text-sm font-medium transition-colors"
          >
            <FaUser className="icon-sm" />
            {pages.contact.readyLinks.viewExperienceLabel}
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Social Media Section -->
  <section class="animate-section bg-muted border-border rounded-lg border p-8 text-center">
    <h2 class="text-foreground mb-4 text-3xl font-bold">{pages.contact.socialSectionTitle}</h2>
    <p class="text-foreground-muted mx-auto mb-6 max-w-2xl">{pages.contact.socialSectionDescription}</p>
    <div class="flex flex-wrap justify-center gap-6">
      {settings.author.socialLinks?.map((link) => {
        const Icon = socialIconForPlatform(link.platform);
        if (!Icon) return null;
        return (
          <a href={link.url} target="_blank" rel="noopener noreferrer" class="bg-primary hover:bg-primary-hover text-on-primary inline-flex items-center gap-2 rounded-lg px-6 py-3 font-medium transition-colors">
            <Icon className="icon-sm" />
            {link.label}
          </a>
        );
      })}
    </div>
  </section>

  <!-- Netlify Turnstile Script -->
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>

  <!-- Form submission handling -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('contact-form');
      if (form) {
        form.addEventListener('submit', e => {
          // Netlify will handle the form submission automatically
          // This is just for any additional client-side handling if needed
        });
      }
    });
  </script>
</MainLayout>
