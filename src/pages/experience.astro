---
import MainLayout from '@/layouts/main-layout.astro';
import ExperienceCard from '@/components/ExperienceCard.astro';
import { getCollection } from 'astro:content';
import CTA from '@/components/CTA.astro';
import { FaBriefcase, FaBrain, FaAward, FaCheck, FaChartLine, FaCode, FaMobile, FaBolt, FaUsers, FaEye, FaCloud } from 'react-icons/fa6';
import homepageContent from '@/content/site/homepage.json';
import pages from '@/content/site/pages.json';

const experience = await getCollection('experience');
const sortedExperience = experience.sort((a, b) => {
  if (a.data.current && !b.data.current) return -1;
  if (!a.data.current && b.data.current) return 1;
  return b.data.date.getTime() - a.data.date.getTime();
});

const yearsOfExperience = new Date().getFullYear() - homepageContent.yearsOfExperienceStartYear;
const experienceSubheading = pages.experience.subheadingTemplate.replaceAll('{yearsOfExperience}', String(yearsOfExperience));
const competencyIcons = [FaCode, FaMobile, FaBolt, FaUsers, FaEye, FaCloud];
---

<MainLayout title={pages.experience.metaTitle} description={pages.experience.metaDescription}>
  <!-- Header Section -->
  <section class="animate-section mb-12 text-center">
    <h1 class="text-foreground mb-4 text-5xl font-bold">{pages.experience.heading}</h1>
    <p class="text-foreground-muted mb-6 text-xl">
      {experienceSubheading}
    </p>
    <p class="text-foreground-muted mx-auto max-w-3xl text-lg leading-relaxed">
      {pages.experience.intro}
    </p>
  </section>

  <!-- Experience Timeline -->
  <section class="animate-section mb-16">
    <h2 class="text-foreground mb-8 flex items-center gap-3 text-2xl font-bold md:text-3xl">
      <FaBriefcase className="text-secondary icon-base" />
      {pages.experience.workExperienceTitle}
    </h2>

    <div class="animate-content space-y-8">
      {sortedExperience.map(exp => <ExperienceCard experience={exp} showAllDetails={true} />)}
    </div>
  </section>

  <!-- Career Highlights -->
  <section class="animate-section mb-16">
    <h2 class="text-foreground mb-8 flex items-center gap-3 text-2xl font-bold md:text-3xl">
      <FaAward className="text-secondary icon-base" />
      {pages.experience.careerHighlightsTitle}
    </h2>

    <div class="grid gap-8 md:grid-cols-2">
      <div class="animate-content bg-surface border-border rounded-lg border p-6 shadow-md">
        <h3 class="text-foreground mb-4 flex items-center gap-2 text-lg font-semibold">
          <FaChartLine className="text-secondary" />
          {pages.experience.keyAchievementsTitle}
        </h3>
        <ul class="space-y-3">
          {
            experience
              .flatMap(exp => exp.data.achievements)
              .slice(0, 6)
              .map(achievement => (
                <li class="text-foreground-muted flex items-start gap-2 text-sm">
                  <FaCheck className="text-secondary mt-0.5" />
                  {achievement}
                </li>
              ))
          }
        </ul>
      </div>

      <div class="animate-content bg-surface border-border rounded-lg border p-6 shadow-md">
        <h3 class="text-foreground mb-4 flex items-center gap-2 text-lg font-semibold">
          <FaBrain className="text-secondary" />
          {pages.experience.coreCompetenciesTitle}
        </h3>
        <ul class="space-y-3">
          {pages.experience.coreCompetencies.map((item, idx) => {
            const Icon = competencyIcons[idx] ?? FaCode;
            return (
              <li class="text-foreground-muted flex items-start gap-2 text-sm">
                <Icon className="text-secondary mt-0.5" />
                <span>{item.title}</span>
              </li>
            );
          })}
        </ul>
      </div>
    </div>
  </section>

  <div class="animate-section">
    <CTA />
  </div>
</MainLayout>
