---
import MainLayout from '@/layouts/main-layout.astro';
import { getCollection, render } from 'astro:content';
import { FaGithub, FaArrowRight, FaCircleInfo, FaClock, FaTag, FaArrowLeft } from 'react-icons/fa6';
import { Image } from 'astro:assets';
import pages from '@/content/site/pages.json';

export async function getStaticPaths() {
  const projects = await getCollection('projects');
  return projects.map(p => ({
    params: { project: p.data.slug },
    props: { project: p },
  }));
}

const { project } = Astro.props;
const { Content } = await render(project);
---

<MainLayout title={project.data.title} description={project.data.description}>
  <article class="mx-auto max-w-screen-lg">
    <!-- Back Navigation -->
    <nav class="mb-8">
      <a href="/projects" class="text-foreground-muted hover:text-foreground group inline-flex items-center gap-1 font-medium transition-colors">
        <FaArrowLeft className="icon-sm transition-transform group-hover:-translate-x-1" />
        Back to Projects
      </a>
    </nav>

    <!-- Project Header -->
    <header class="mb-12">
      <!-- Meta Info -->
      <div class="mb-6 flex flex-wrap items-center gap-3">
        {
          ((project.data.featured ?? false) || (project.data.pinned ?? false)) && (
            <span class="bg-secondary/10 text-secondary border-secondary/20 inline-flex items-center gap-1.5 rounded-full border px-3 py-1 text-xs font-semibold tracking-wide uppercase">
              <FaTag className="icon-xs" />
              {pages.home.sections.featuredProjectsTitle}
            </span>
          )
        }
        {
          project.data.completedOn && (
            <span class="text-foreground-muted inline-flex items-center gap-1.5 text-sm">
              <FaClock className="icon-xs" />
              {project.data.completedOn.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
              })}
            </span>
          )
        }
      </div>

      <!-- Title -->
      <h1 class="text-foreground mb-6 text-4xl leading-tight font-bold tracking-tight md:text-5xl lg:text-6xl">
        {project.data.title}
      </h1>

      <!-- Description -->
      {(project.data.summary || project.data.description) && (
        <p class="text-foreground-muted mb-8 text-xl leading-relaxed md:text-2xl">{project.data.summary || project.data.description}</p>
      )}

      <!-- Technologies -->
      {
        ((project.data.technologies ?? project.data.tags) && (project.data.technologies ?? project.data.tags).length > 0) && (
          <div class="mb-8 flex flex-wrap gap-2">
            {(project.data.technologies?.length ? project.data.technologies : project.data.tags).slice(0, 8).map(tagSlug => (
              <span class="bg-muted text-foreground border-border hover:bg-muted/80 inline-flex items-center rounded-md border px-3 py-1 text-sm font-medium transition-colors">
                {tagSlug}
              </span>
            ))}
          </div>
        )
      }

      <!-- Action Buttons -->
      <div class="flex flex-wrap items-center gap-3">
        {
          (project.data.liveUrl || project.data.link) && (
            <a
              href={project.data.liveUrl || project.data.link}
              target="_blank"
              rel="noopener noreferrer"
              class="bg-secondary hover:bg-secondary-hover text-on-secondary group inline-flex items-center gap-2 rounded-md px-4 py-2 font-medium transition-colors"
            >
              <span>Visit Live Project</span>
              <FaArrowRight className="icon-sm transition-transform group-hover:translate-x-1" />
            </a>
          )
        }

        {
          (project.data.repoUrl || project.data.githubLink) && (
            <a
              href={project.data.repoUrl || project.data.githubLink}
              target="_blank"
              rel="noopener noreferrer"
              class="bg-surface hover:bg-muted border-border text-foreground group inline-flex items-center gap-2 rounded-md border px-4 py-2 font-medium transition-colors"
            >
              <FaGithub className="icon-sm" />
              <span>View Source</span>
            </a>
          )
        }

        <a href="#project-details" class="text-foreground-muted hover:text-secondary group inline-flex items-center gap-2 px-3 py-2 font-medium transition-colors">
          <FaCircleInfo className="icon-sm" />
          <span>More Details</span>
        </a>
      </div>

      <!-- Featured Image -->
      {
        project.data.featuredImage && (
          <div class="border-border mt-12 overflow-hidden rounded-xl border shadow-2xl">
            <Image src={project.data.featuredImage} alt={project.data.title} class="h-full w-full object-cover" loading="eager" width={1200} height={630} />
          </div>
        )
      }
    </header>

    <!-- Project Content -->
    {
      project.body && (
        <div class="typography mb-8 max-w-none">
          <Content />
        </div>
      )
    }

    <!-- Project Details -->
    <div id="project-details" class="bg-muted border-border mb-12 rounded-lg border p-6">
      <div class="mb-4 flex items-end justify-between gap-4">
        <h2 class="text-foreground text-lg font-semibold">Project Details</h2>
        <span class="text-foreground-muted text-sm">Quick facts</span>
      </div>

      <dl class="grid gap-4 md:grid-cols-2">
        {
          project.data.completedOn && (
            <div class="bg-surface border-border rounded-lg border p-4">
              <dt class="text-foreground-muted mb-1 text-xs font-semibold tracking-wide uppercase">Completion Date</dt>
              <dd class="text-foreground text-base font-medium">
                {project.data.completedOn.toLocaleDateString('en-US', {
                  year: 'numeric',
                  month: 'long',
                })}
              </dd>
            </div>
          )
        }

        {
          (project.data.liveUrl || project.data.link) && (
            <div class="bg-surface border-border rounded-lg border p-4">
              <dt class="text-foreground-muted mb-1 text-xs font-semibold tracking-wide uppercase">Project URL</dt>
              <dd class="text-base">
                <a
                  href={project.data.liveUrl || project.data.link}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="text-secondary hover:text-secondary-hover decoration-secondary/30 hover:decoration-secondary font-medium break-all underline underline-offset-2 transition-colors"
                >
                  {project.data.liveUrl || project.data.link}
                </a>
              </dd>
            </div>
          )
        }

        {
          (project.data.repoUrl || project.data.githubLink) && (
            <div class="bg-surface border-border rounded-lg border p-4 md:col-span-2">
              <dt class="text-foreground-muted mb-1 text-xs font-semibold tracking-wide uppercase">GitHub Repository</dt>
              <dd class="text-base">
                <a
                  href={project.data.repoUrl || project.data.githubLink}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="text-secondary hover:text-secondary-hover decoration-secondary/30 hover:decoration-secondary font-medium break-all underline underline-offset-2 transition-colors"
                >
                  {project.data.repoUrl || project.data.githubLink}
                </a>
              </dd>
            </div>
          )
        }

        {
          (project.data.technologies?.length || project.data.tags?.length) && (
            <div class="bg-surface border-border rounded-lg border p-4 md:col-span-2">
              <dt class="text-foreground-muted mb-3 text-xs font-semibold tracking-wide uppercase">Technologies Used</dt>
              <dd class="flex flex-wrap gap-2">
                {(project.data.technologies?.length ? project.data.technologies : project.data.tags).map(tagSlug => (
                  <span class="bg-muted text-foreground border-border rounded border px-2 py-1 text-xs font-medium">{tagSlug}</span>
                ))}
              </dd>
            </div>
          )
        }
      </dl>
    </div>

    <!-- Project Footer -->
    <footer class="border-border mt-16 border-t pt-8">
      <div class="flex items-center justify-between">
        <a href="/projects" class="text-secondary hover:text-secondary-hover group flex items-center gap-1 font-medium">
          <FaArrowLeft className="icon-sm transition-transform group-hover:-translate-x-1" />
          View All Projects
        </a>
      </div>
    </footer>
  </article>
</MainLayout>
