---
import { Image } from 'astro:assets';
import tags from 'content/tags';

interface Props {
  project: {
    data: {
      title: string;
      slug?: string;
      description?: string;
      tags: string[];
      featuredImage?: string;
      link?: string;
      completedOn?: Date;
      pinned?: boolean;
    };
  };
  showCompletedDate?: boolean;
}

const { project, showCompletedDate = false } = Astro.props;

// Create a map of tag slugs to tag data
const tagMap = new Map(tags.map(tag => [tag.slug, tag]));
---

<article class="border-primary-100 flex flex-col overflow-hidden rounded-lg border bg-white shadow-lg transition-shadow hover:shadow-xl">
  <div class="bg-primary-50 relative aspect-video overflow-hidden">
    {
      project.data.featuredImage ? (
        <Image src={project.data.featuredImage} alt={project.data.title} class="h-full w-full object-cover" loading="eager" width={600} height={400} />
      ) : (
        <div class="bg-primary-100 flex h-full w-full items-center justify-center">
          <span class="text-primary-500 flex items-center gap-2">
            No Image <i data-feather="image" class="h-4 w-4" />
          </span>
        </div>
      )
    }
    {
      project.data.pinned && (
        <div class="absolute right-0 bottom-0 z-10 flex w-full">
          <span class="bg-secondary-100 text-secondary-800 w-full px-2 py-1 text-center text-xs font-semibold">Featured</span>
        </div>
      )
    }
  </div>

  <div class="flex flex-1 flex-col p-6">
    <h3 class="text-primary-900 mb-3 text-xl font-semibold">
      {
        project.data.link ? (
          <a href={`/projects/${project.data.slug}`} class="hover:text-secondary-600 transition-colors">
            {project.data.title}
          </a>
        ) : (
          project.data.title
        )
      }
    </h3>

    {
      showCompletedDate && project.data.completedOn && (
        <div class="text-primary-600 mb-3 text-sm">
          Completed:{' '}
          {project.data.completedOn.toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
          })}
        </div>
      )
    }

    {project.data.description && <p class="text-primary-700 mb-4 text-sm leading-relaxed">{project.data.description}</p>}

    <div class="mb-4 flex flex-wrap gap-2">
      {
        project.data.tags.slice(0, 3).map(tagSlug => {
          const tag = tagMap.get(tagSlug);
          return <span class="bg-primary-100 text-primary-700 rounded-full px-3 py-1 text-xs font-medium">{tag?.title || tagSlug}</span>;
        })
      }
    </div>

    <div class="border-primary-100 mt-auto flex items-center justify-between border-t pt-4">
      <a href={`/projects/${project.data.slug}`} class="text-secondary-600 hover:text-secondary-800 flex items-center gap-1 font-medium">
        Learn more <span data-feather="arrow-right" class="h-4 w-4"></span>
      </a>
      {
        project.data.link && (
          <a href={project.data.link} class="text-primary-600 hover:text-primary-800 flex items-center gap-1" target="_blank" rel="noopener noreferrer">
            View project <span data-feather="external-link" class="h-4 w-4" />
          </a>
        )
      }
    </div>
  </div>
</article>
