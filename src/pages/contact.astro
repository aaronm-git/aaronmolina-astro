---
import MainLayout from '@/layouts/main-layout.astro';
import InfoBox from '@/components/molecules/InfoBox.astro';
import ListItem from '@/components/molecules/ListItem.astro';
import Button from '@/components/atoms/Button.astro';
import SocialLinks from '@/components/molecules/SocialLinks.astro';
import { getCategoryIcon } from '@/lib/icons';
import pages from '@/content/site/pages.json';
import settings from '@/content/site/settings.json';

// Netlify Turnstile site key - configure this in your Netlify dashboard
const TURNSTILE_SITE_KEY = import.meta.env.PUBLIC_TURNSTILE_SITE_KEY || 'YOUR_TURNSTILE_SITE_KEY';

const whyIconNames = ['briefcase', 'bolt', 'users', 'shield'];
const responseIconNames = ['clock', 'calendar', 'globe'];
---

<MainLayout title={pages.contact.metaTitle} description={pages.contact.metaDescription}>
  <!-- Header -->
  <section class="animate-section mb-12 text-center">
    <h1 class="text-foreground mb-4 text-5xl font-bold">{pages.contact.heading}</h1>
    <p class="text-foreground-muted mx-auto max-w-2xl text-lg">
      {pages.contact.intro}
    </p>
  </section>

  <!-- Contact Form -->
  <div class="animate-section mb-16 grid gap-12 lg:grid-cols-2">
    <!-- Form -->
    <InfoBox title={pages.contact.formTitle} variant="surface">
      <form id="contact-form" name="contact" method="POST" data-netlify="true" netlify-honeypot="bot-field" class="space-y-6">
        <div class="grid gap-6 md:grid-cols-2">
          <div>
            <label for="name" class="text-foreground mb-2 block text-sm font-medium">Full Name</label>
            <input
              type="text"
              name="name"
              required
              class="border-border bg-surface text-foreground placeholder:text-foreground-muted focus:border-ring focus:ring-ring focus:ring-offset-background w-full rounded-md border px-3 py-2 focus:ring-2 focus:ring-offset-2 focus:outline-none"
              placeholder="Your name"
            />
          </div>

          <div>
            <label for="email" class="text-foreground mb-2 block text-sm font-medium">Email Address</label>
            <input
              type="email"
              name="email"
              required
              class="border-border bg-surface text-foreground placeholder:text-foreground-muted focus:border-ring focus:ring-ring focus:ring-offset-background w-full rounded-md border px-3 py-2 focus:ring-2 focus:ring-offset-2 focus:outline-none"
              placeholder="your@email.com"
            />
          </div>
        </div>

        <div>
          <label for="company" class="text-foreground mb-2 block text-sm font-medium">Company (Optional)</label>
          <input
            type="text"
            name="company"
            class="border-border bg-surface text-foreground placeholder:text-foreground-muted focus:border-ring focus:ring-ring focus:ring-offset-background w-full rounded-md border px-3 py-2 focus:ring-2 focus:ring-offset-2 focus:outline-none"
            placeholder="Your company"
          />
        </div>

        <div>
          <label for="project-type" class="text-foreground mb-2 block text-sm font-medium">Project Type</label>
          <select
            name="project-type"
            class="border-border bg-surface text-foreground focus:border-ring focus:ring-ring focus:ring-offset-background w-full rounded-md border px-3 py-2 focus:ring-2 focus:ring-offset-2 focus:outline-none"
          >
            <option value="">Select a project type</option>
            <option value="frontend">Frontend Development</option>
            <option value="fullstack">Full-Stack Application</option>
            <option value="website">Website Development</option>
            <option value="consultation">Technical Consultation</option>
            <option value="optimization">Performance Optimization</option>
            <option value="other">Other</option>
          </select>
        </div>

        <div>
          <label for="budget" class="text-foreground mb-2 block text-sm font-medium">Budget Range (Optional)</label>
          <select
            name="budget"
            class="border-border bg-surface text-foreground focus:border-ring focus:ring-ring focus:ring-offset-background w-full rounded-md border px-3 py-2 focus:ring-2 focus:ring-offset-2 focus:outline-none"
          >
            <option value="">Select budget range</option>
            <option value="under-5k">Under $5,000</option>
            <option value="5k-15k">$5,000 - $15,000</option>
            <option value="15k-30k">$15,000 - $30,000</option>
            <option value="30k-plus">$30,000+</option>
            <option value="discuss">Let's discuss</option>
          </select>
        </div>

        <div>
          <label for="message" class="text-foreground mb-2 block text-sm font-medium">Project Details</label>
          <textarea
            name="message"
            rows="6"
            required
            class="border-border bg-surface text-foreground placeholder:text-foreground-muted focus:border-ring focus:ring-ring focus:ring-offset-background w-full rounded-md border px-3 py-2 focus:ring-2 focus:ring-offset-2 focus:outline-none"
            placeholder="Tell me about your project, timeline, and any specific requirements..."></textarea>
        </div>

        <!-- Hidden fields for Netlify -->
        <input type="hidden" name="form-name" value="contact" />
        <!-- Honeypot field for spam protection -->
        <input type="hidden" name="bot-field" />

        <!-- Netlify Turnstile Captcha -->
        <div class="cf-turnstile" data-sitekey={TURNSTILE_SITE_KEY}></div>

        <Button type="submit" variant="secondary" fullWidth size="lg">
          Send Message
        </Button>
      </form>
    </InfoBox>

    <!-- Contact Info -->
    <div class="space-y-8">
      <InfoBox title={pages.contact.whyWorkWithMeTitle} variant="surface">
        <div class="space-y-4">
          {pages.contact.whyWorkWithMeItems.map((item, idx) => {
            const Icon = getCategoryIcon(whyIconNames[idx] || 'briefcase');
            return (
              <div class="flex items-start gap-3">
                {Icon && <Icon className="text-secondary icon-base mt-1 flex-shrink-0" />}
                <div>
                  <h4 class="text-foreground font-medium">{item.title}</h4>
                  <p class="text-foreground-muted text-sm">{item.description}</p>
                </div>
              </div>
            );
          })}
        </div>
      </InfoBox>

      <InfoBox title={pages.contact.responseTimeTitle} variant="surface">
        <ul class="space-y-3">
          {pages.contact.responseTimeItems.map((text, idx) => (
            <ListItem icon={responseIconNames[idx] || 'clock'} iconColor="secondary" size="sm">
              {text}
            </ListItem>
          ))}
        </ul>
      </InfoBox>

      <InfoBox title={pages.contact.readyToStartTitle} variant="muted">
        <p class="text-foreground-muted mb-4 text-sm">{pages.contact.readyToStartDescription}</p>
        <div class="flex gap-3">
          <Button href="/projects" variant="outline" icon="briefcase" size="sm">
            {pages.contact.readyLinks.viewProjectsLabel}
          </Button>
          <Button href="/experience" variant="outline" icon="user" size="sm">
            {pages.contact.readyLinks.viewExperienceLabel}
          </Button>
        </div>
      </InfoBox>
    </div>
  </div>

  <!-- Social Media Section -->
  <section class="animate-section bg-muted border-border rounded-lg border p-8 text-center">
    <h2 class="text-foreground mb-4 text-3xl font-bold">{pages.contact.socialSectionTitle}</h2>
    <p class="text-foreground-muted mx-auto mb-6 max-w-2xl">{pages.contact.socialSectionDescription}</p>
    {settings.author.socialLinks && (
      <div class="flex justify-center">
        <SocialLinks links={settings.author.socialLinks} variant="button" size="base" />
      </div>
    )}
  </section>

  <!-- Netlify Turnstile Script -->
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>

  <!-- Form submission handling -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('contact-form');
      if (form) {
        form.addEventListener('submit', e => {
          // Netlify will handle the form submission automatically
          // This is just for any additional client-side handling if needed
        });
      }
    });
  </script>
</MainLayout>
