---
import { cn } from '@/lib/cn';
import { getIcon } from '@/lib/icons';
import type { IconType } from 'react-icons';

type BadgeVariant = 'default' | 'primary' | 'secondary' | 'success' | 'warning' | 'error' | 'outline';
type BadgeSize = 'xs' | 'sm' | 'base';

interface Props {
  /** Badge label */
  label: string;
  /** Visual variant */
  variant?: BadgeVariant;
  /** Badge size */
  size?: BadgeSize;
  /** Icon name */
  icon?: string;
  /** Direct icon component */
  iconComponent?: IconType;
  /** Show dot indicator */
  dot?: boolean;
  /** Dot color (defaults to variant color) */
  dotColor?: 'primary' | 'secondary' | 'success' | 'warning' | 'error';
  /** Additional CSS classes */
  class?: string;
}

const {
  label,
  variant = 'default',
  size = 'sm',
  icon,
  iconComponent,
  dot = false,
  dotColor,
  class: className = '',
} = Astro.props;

// Resolve icon
const IconComponent = iconComponent || (icon ? getIcon(icon) : null);

// Variant classes
const variantClasses: Record<BadgeVariant, string> = {
  default: 'bg-muted text-foreground',
  primary: 'bg-primary/10 text-primary',
  secondary: 'bg-secondary/10 text-secondary',
  success: 'bg-green-500/10 text-green-600',
  warning: 'bg-yellow-500/10 text-yellow-600',
  error: 'bg-red-500/10 text-red-600',
  outline: 'bg-transparent border border-border text-foreground',
};

// Size classes
const sizeClasses: Record<BadgeSize, string> = {
  xs: 'px-1.5 py-0.5 text-[10px]',
  sm: 'px-2 py-0.5 text-xs',
  base: 'px-2.5 py-1 text-sm',
};

// Icon size classes
const iconSizeClasses: Record<BadgeSize, string> = {
  xs: 'w-2.5 h-2.5',
  sm: 'w-3 h-3',
  base: 'w-3.5 h-3.5',
};

// Dot color classes
const dotColorClasses: Record<string, string> = {
  primary: 'bg-primary',
  secondary: 'bg-secondary',
  success: 'bg-green-500',
  warning: 'bg-yellow-500',
  error: 'bg-red-500',
};

// Default dot color based on variant
const effectiveDotColor = dotColor || (variant !== 'default' && variant !== 'outline' ? variant : 'primary');

const combinedClasses = cn(
  'inline-flex items-center gap-1 rounded-full font-medium',
  variantClasses[variant],
  sizeClasses[size],
  className,
);
---

<span class={combinedClasses}>
  {dot && (
    <span class={cn('w-1.5 h-1.5 rounded-full', dotColorClasses[effectiveDotColor])} />
  )}
  {IconComponent && (
    <IconComponent className={iconSizeClasses[size]} />
  )}
  {label}
</span>
