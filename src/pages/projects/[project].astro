---
import MainLayout from '@/layouts/main-layout.astro';
import { Image } from 'astro:assets';
import { getCollection, render } from 'astro:content';
import tags from 'content/tags';

export async function getStaticPaths() {
  const projects = await getCollection('projects');
  return projects.map(p => ({
    params: { project: p.data.slug },
    props: { project: p },
  }));
}

const { project } = Astro.props;
const { Content } = await render(project);

// Create a map of tag slugs to tag data
const tagMap = new Map(tags.map(tag => [tag.slug, tag]));
---

<MainLayout title={project.data.title} description={project.data.description}>
  <article class="mx-auto max-w-4xl px-4 py-8">
    <!-- Project Header -->
    <header class="mb-8">
      <div class="mb-4 flex items-center justify-between">
        <h1 class="text-primary-900 text-4xl font-bold">
          {project.data.title}
        </h1>
        {project.data.pinned && <span class="bg-secondary-100 text-secondary-800 flex-shrink-0 rounded-full px-3 py-1 text-sm font-semibold">Featured Project</span>}
      </div>

      <div class="text-primary-600 mb-6 flex items-center justify-between">
        <div class="flex items-center gap-6">
          <a href="#project-details" class="text-secondary-600 hover:text-secondary-800 flex items-center gap-2 transition-colors">
            <span class="flex items-center gap-2 text-sm font-medium"><i data-feather="info" class="h-4 w-4"></i> Project Details</span>
          </a>
          |
          {
            project.data.link && (
              <a href={project.data.link} target="_blank" rel="noopener noreferrer" class="text-secondary-600 hover:text-secondary-800 flex items-center gap-2 transition-colors">
                <span class="text-sm font-medium">Visit Project</span>
                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                </svg>
              </a>
            )
          }
        </div>
      </div>

      {project.data.description && <p class="text-primary-700 mb-6 text-xl leading-relaxed">{project.data.description}</p>}

      <!-- 
      {
        project.data.tags && project.data.tags.length > 0 && (
          <div class="mb-6 flex flex-wrap gap-2">
            {project.data.tags.map(tagSlug => {
              const tag = tagMap.get(tagSlug);
              return <span class="bg-secondary-100 text-secondary-800 rounded-full px-3 py-1 text-sm font-medium">{tag?.title || tagSlug}</span>;
            })}
          </div>
        )
      } -->
    </header>

    <!-- Project Content -->
    {
      project.body && (
        <div class="typography mb-8 max-w-none">
          <Content />
        </div>
      )
    }

    <!-- Project Details -->
    <div class="bg-primary-50 border-primary-200 mb-8 rounded-lg border p-6" id="project-details">
      <h2 class="text-primary-900 mb-4 text-lg font-semibold">Project Details</h2>

      <div class="grid gap-4 md:grid-cols-2">
        {
          project.data.completedOn && (
            <div>
              <dt class="text-primary-600 mb-1 text-sm font-medium">Completion Date</dt>
              <dd class="text-primary-900 text-sm">
                {project.data.completedOn.toLocaleDateString('en-US', {
                  year: 'numeric',
                  month: 'long',
                })}
              </dd>
            </div>
          )
        }

        {
          project.data.link && (
            <div>
              <dt class="text-primary-600 mb-1 text-sm font-medium">Project URL</dt>
              <dd class="text-sm">
                <a href={project.data.link} target="_blank" rel="noopener noreferrer" class="text-secondary-600 hover:text-secondary-800 break-all">
                  {project.data.link}
                </a>
              </dd>
            </div>
          )
        }

        {
          project.data.tags && project.data.tags.length > 0 && (
            <div class="md:col-span-2">
              <dt class="text-primary-600 mb-2 text-sm font-medium">Technologies Used</dt>
              <dd class="flex flex-wrap gap-2">
                {project.data.tags.map(tagSlug => {
                  const tag = tagMap.get(tagSlug);
                  return <span class="text-primary-700 border-primary-200 rounded border bg-white px-2 py-1 text-xs">{tag?.title || tagSlug}</span>;
                })}
              </dd>
            </div>
          )
        }
      </div>
    </div>

    <!-- Project Footer -->
    <footer class="border-primary-200 border-t pt-8">
      <div class="flex items-center justify-between">
        <a href="/projects" class="text-secondary-600 hover:text-secondary-800 flex items-center gap-2">
          <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
          </svg>
          Back to Projects
        </a>

        {
          project.data.link && (
            <a
              href={project.data.link}
              target="_blank"
              rel="noopener noreferrer"
              class="bg-secondary-600 hover:bg-secondary-700 flex items-center gap-2 rounded-lg px-4 py-2 text-white transition-colors"
            >
              <span>View Live Project</span>
              <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
              </svg>
            </a>
          )
        }
      </div>
    </footer>
  </article>
</MainLayout>
